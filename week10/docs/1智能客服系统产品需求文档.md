# 产品需求文档（PRD）  
**产品名称**：AI教育行业智能客服系统（基于LangChain 1.0）  
**版本**：V1.0  
**最后更新日期**：2025年11月14日  

---

## 一、产品概述  
### 1.1 业务背景  
- **核心痛点**：  
  - 人工客服人力成本高（占运营成本40%），平均响应时间>2分钟  
  - 教育行业常见问题重复率超60%（课程咨询、退费政策、学习进度查询等）  
  - 知识库更新延迟导致客服回答错误率高达15%  

### 1.2 业务价值  
| 指标                | 当前状态       | 目标状态         | 提升效果         |  
|---------------------|---------------|-----------------|----------------|  
| 人力成本占比        | 40%           | ≤15%            | 降低25%         |  
| 平均响应时间        | 120秒         | ≤500ms          | 提升240倍       |  
| 问题解决率          | 75%           | ≥92%            | 提升17%         |  
| 知识更新延迟        | 3-7天         | 实时更新        | 100%即时生效     |  

---

## 二、用户场景定义（AI教育行业）  
### 2.1 核心交互场景  
| 场景类型         | 用户问题示例                          | 系统响应流程                              |  
|------------------|-------------------------------------|-----------------------------------------|  
| **课程咨询**     | "Python入门课包含哪些内容？"          | RAG检索课程大纲 → 结构化输出课程模块+学习路径 |  
| **订单查询**     | "查询订单#20251114001的退款进度"       | 调用订单API → 解析数据库 → 生成进度可视化报告 |  
| **学习支持**     | "第3章作业提交失败怎么办？"            | 多轮对话确认环境 → 提供分步解决方案+视频指引 |  
| **政策咨询**     | "退费规则中‘开课后7天内’如何计算？"     | 精准定位政策文档 → 结合案例解释条款细节     |  

### 2.2 异常场景处理  
- **敏感信息触发**：当用户输入"账号密码"等关键词时，自动触发脱敏中间件并返回安全提示  
- **知识盲区**：未匹配到知识库内容时，自动转接人工并记录问题至待优化列表  

---

## 三、功能需求规范  
### 3.1 核心功能模块  
#### 3.1.1 智能对话引擎
| 组件               | LangChain 实现                       | 技术边界说明                     |  
|--------------------|-------------------------------------|-------------------------------|  
| **多代理系统**     | `create_agent()` + Router Chain     | 完全由LangChain实现             |  
| **RAG核心**        | `FAISSVectorStore` + `Retriever`    | 需定制知识分块策略（按教育文档章节）|  
| **ReACT推理**      | `ReActAgentExecutor`                | 需扩展教育行业工具描述模板       |  
| **工具调用**       | `Tool` + `SQLDatabaseToolkit`       | 需开发订单API适配器             |  

#### 3.1.2 安全中间件系统  
```python  
# LangChain v1.0中间件实现示例  
class EduSecurityMiddleware:  
    def __init__(self):  
        self.sensitive_words = ["密码", "身份证", "银行卡"]  
        self.role_permissions = {"student": ["query_order"], "admin": ["refund_approve"]}  

    def preprocess(self, input: str) -> str:  
        # 敏感词过滤  
        for word in self.sensitive_words:  
            input = re.sub(f"({word}.{{0,10}}\d+)", "[REDACTED]", input)  
        return input  

    def check_permission(self, user_role: str, tool_name: str) -> bool:  
        return tool_name in self.role_permissions.get(user_role, [])  
```  

#### 3.1.3 可维护性模块  
| 功能               | 实现方案                              |  
|--------------------|-------------------------------------|  
| **知识库热更新**   | 监听OSS存储桶 → 自动触发`FAISS`索引重建 |  
| **对话日志分析**   | 记录`agent_executor`中间步骤 → 生成TOP10未解决问题报表 |  

---

## 四、技术架构规范  
### 4.1 系统架构图  
```
用户请求 → [安全中间件] → [Router Agent]  
                ↓  
[ReACT Agent] ←→ [RAG Agent] ←→ [Tool Agent]  
                ↓  
[FAISS向量库]   [Qwen Turbo]   [订单API]  
```  

### 4.2 技术栈明细  
| 模块                | 技术选型                  | 版本要求       |  
|---------------------|-------------------------|--------------|  
| 核心框架            | LangChain               | ≥1.0.0       |  
| 向量数据库          | FAISS                   | 1.8.0        |  
| 大语言模型          | Qwen-Turbo              | 通义千问API  |  
| 数据存储            | MySQL + OSS             | 8.0+         |  
| 安全中间件          | 自定义LangChain回调     | 需适配v1.0   |  

### 4.3 关键接口定义  
**订单查询API适配器**  
```python  
def query_order_tool(order_id: str) -> dict:  
    """  
    输入：订单ID（格式#YYYYMMDDnnn）  
    输出：{  
        "status": "processing/refunded",  
        "amount": 199.0,  
        "timeline": ["2025-11-10 申请", "2025-11-12 审核中"]  
    }  
    """  
    # 调用企业订单系统REST API  
    return order_service.get(order_id)  
```  

---

## 五、非功能需求  
### 5.1 性能指标  
- **响应时间**：P95 ≤ 500ms（含RAG检索+模型推理）  
- **并发能力**：支持500+ QPS（通过LangChain异步执行优化）  
- **准确率**：知识库问题解决率 ≥ 92%（基于测试集验证）  

### 5.2 安全规范  
- **数据脱敏**：所有用户输入经`EduSecurityMiddleware.preprocess()`处理  
- **权限隔离**：工具调用前必须通过`check_permission()`验证  
- **审计日志**：记录所有敏感操作（如退款审批）  

### 5.3 可维护性要求  
- **知识库更新**：OSS文件变动后5分钟内完成索引重建  
- **对话分析**：每日生成《未解决问题TOP10》报表至运营后台  

---

## 六、实施阶段规划  
### 6.1 需求细化阶段（已完成）  
- 已完成LangChain组件映射：  
  - RAG系统 → `FAISSVectorStore` + `ContextualCompressionRetriever`  
  - 多代理路由 → `ConditionalRouter` + `MultiRuleAgent`  

### 6.2 原型验证阶段（待执行）  
**验证重点**：  
1. RAG知识检索准确率测试（使用100条教育行业QA对）  
2. ReACT代理在订单查询场景的API调用成功率  
3. 安全中间件对敏感信息的拦截效果  

**交付物**：  
- 可运行的MVP系统（包含课程咨询+订单查询基础功能）  
- 压力测试报告（JMeter模拟200并发）  

### 6.3 系统集成阶段（后续计划）  
- 集成企业微信/钉钉客服接口  
- 部署对话日志分析流水线（ELK Stack）  
- 实现知识库自动更新工作流  

---

## 七、验收标准  
| 模块               | 验收项                          | 通过标准                     |  
|--------------------|-------------------------------|---------------------------|  
| RAG系统            | 课程政策问题回答准确率           | ≥90%                      |  
| 工具调用           | 订单查询API调用成功率            | 100%                      |  
| 安全中间件         | 敏感信息拦截率                  | 100%                      |  
| 系统性能           | 500并发下P95响应时间            | ≤800ms                    |  

